name: ğŸ¦† DuckDNS Auto Update

on:
  schedule:
    - cron: '*/10 * * * *'  # 10ë¶„ë§ˆë‹¤ ì‹¤í–‰
  workflow_dispatch:        # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥

jobs:
  update-duckdns:
    runs-on: ubuntu-latest
    steps:
      - name: ğŸ”„ DuckDNS IP ì—…ë°ì´íŠ¸
        run: |
          echo "ğŸ¦† DuckDNS ìë™ ì—…ë°ì´íŠ¸ ì‹œì‘..."
          echo "ğŸŒ ë„ë©”ì¸: gitvisualizer.duckdns.org"
          
          # Vercel IP ë™ì  ê°ì§€
          echo "ğŸ” í˜„ì¬ Vercel IP í™•ì¸ ì¤‘..."
          VERCEL_IP=$(nslookup git-visualizer-201910825.vercel.app | grep -A1 "Name:" | tail -1 | awk '{print $2}' || echo "216.198.79.193")
          echo "ğŸ“ ê°ì§€ëœ Vercel IP: $VERCEL_IP"
          
          response=$(curl -s "https://www.duckdns.org/update?domains=gitvisualizer&token=${{ secrets.DUCKDNS_TOKEN }}&ip=$VERCEL_IP")
          
          echo "ğŸ“¡ DuckDNS ì„œë²„ ì‘ë‹µ: $response"
          
          if [ "$response" = "OK" ]; then
            echo "âœ… DuckDNS IP ì—…ë°ì´íŠ¸ ì„±ê³µ!"
            echo "ğŸ‰ gitvisualizer.duckdns.org â†’ $VERCEL_IP"
          else
            echo "âŒ DuckDNS ì—…ë°ì´íŠ¸ ì‹¤íŒ¨!"
            echo "ğŸš¨ ì‘ë‹µ: $response"
            exit 1
          fi

      - name: ğŸ” ë„ë©”ì¸ ìƒíƒœ í™•ì¸
        run: |
          echo "ğŸ” DNS ì „íŒŒ ìƒíƒœ í™•ì¸ ì¤‘..."
          nslookup gitvisualizer.duckdns.org || echo "â³ DNS ì „íŒŒ ëŒ€ê¸° ì¤‘..."
          
      - name: ğŸ“Š ì™„ë£Œ ìƒíƒœ
        run: |
          echo "ğŸ¯ ìë™ ì—…ë°ì´íŠ¸ ì‘ì—… ì™„ë£Œ!"
          echo "â° ë‹¤ìŒ ì‹¤í–‰: 10ë¶„ í›„"
          echo "ğŸŒ ì‚¬ì´íŠ¸: https://gitvisualizer.duckdns.org"
